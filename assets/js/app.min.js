jQuery(document).ready(function(e){function t(){"none"!=p?navigator.serviceWorker.register(d+"/letsrecover-sw.js",{scope:"/"}).then(function(e){n()},e=>{console.error("[SW] Service worker registration failed",e)}):n()}function n(){"default"==Notification.permission?"native"==u?r():o():"granted"==Notification.permission&&(g&&g.setAttribute("style","display: inline-block;"),s())}function o(){sessionStorage.getItem("_letsrecoverPromptShow")||(sessionStorage.setItem("_letsrecoverPromptShow",1),document.getElementsByTagName("wplrpPromptWrapper")[0].style.display="block")}function r(){Notification.requestPermission().then(e=>{switch(e){case"default":case"denied":break;case"granted":return g&&g.setAttribute("style","display: inline-block;"),i()}})}function i(e=null){navigator.serviceWorker.ready.then(function(t){t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:a(l)}).then(t=>{c(t,e?"PUT":"POST")}).catch(t=>{e.unsubscribe().then(function(e){r()})})})}function s(){navigator.serviceWorker.ready.then(e=>e.pushManager.getSubscription()).then(e=>{if(!e)return console.log("already subscribed but subscription not found"),void r();i(e)}).catch(e=>{console.log(e)})}function a(e){const t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),o=window.atob(n),r=new Uint8Array(o.length);for(let e=0;e<o.length;++e)r[e]=o.charCodeAt(e);return r}function c(e,t){if(sessionStorage.getItem("_letsrecoverEndPoint")==e.endpoint)return;const n=e.getKey("p256dh"),o=e.getKey("auth");var r={endpoint:e.endpoint,key:n?btoa(String.fromCharCode.apply(null,new Uint8Array(n))):null,token:o?btoa(String.fromCharCode.apply(null,new Uint8Array(o))):null,type:t,action:"letsrecover_save_subscription"};jQuery.ajax({url:d+"/wp-admin/admin-ajax.php",data:r,type:"POST",success:function(){sessionStorage.setItem("_letsrecoverEndPoint",e.endpoint)}})}var l,u,n,p,d,y=window.letsrecover.q||[],f={subscribe:function(e,n,o,r=null){l=e,p=r,u=o,d=n,"granted"==Notification.permission&&t()},show_prompt:function(){"granted"!=Notification.permission&&("serviceWorker"in navigator?"PushManager"in window?"showNotification"in ServiceWorkerRegistration.prototype?t():console.warn("Notifications are not supported by this browser"):console.warn("Push notifications are not supported by this browser"):console.warn("Service workers are not supported by this browser"))},prompt_action:function(e){document.getElementsByTagName("wplrpPromptWrapper")[0].style.display="none","Approve"==e&&r()}};const g=document.querySelector("#test-push-button");document.querySelector("#send-push-button"),document.querySelector("#friend-list a.accept");window.letsrecover=function(){f[arguments[0]].apply(this,Array.prototype.slice.call(arguments,1))},y.forEach(function(e){window.letsrecover.apply(this,e)}),jQuery("body").on("added_to_cart",function(){"default"==Notification.permission&&r()})});